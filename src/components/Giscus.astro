---
// Utterances.astro
// Astro component to embed Utterances comments
const {
  repo = "chad-collins/chad-collins.github.io",
  issueTerm = "pathname",
  label = "",
  theme = "github-light"
} = Astro.props;
---

<div id="utterances-comments"></div>

<script is:inline>
  // Initialize Utterances
  function loadUtterances() {
    const script = document.createElement('script');
    script.src = 'https://utteranc.es/client.js';
    script.setAttribute('repo', 'chad-collins/chad-collins.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('label', 'comments');
    
    // Set theme based on current color scheme
    const isDark = document.documentElement.classList.contains('dark');
    script.setAttribute('theme', isDark ? 'dark-blue' : 'github-light');
    
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;
    
    document.getElementById('utterances-comments').appendChild(script);
  }
  
  // Load Utterances when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadUtterances);
  } else {
    loadUtterances();
  }
  
  // Handle theme changes
  const observer = new MutationObserver(() => {
    const iframe = document.querySelector('.utterances-frame');
    if (iframe) {
      const isDark = document.documentElement.classList.contains('dark');
      const message = {
        type: 'set-theme',
        theme: isDark ? 'github-dark' : 'github-light'
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  });
  
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
</script>

<style>
  #giscus-comments {
    max-width: 680px;
    margin: 60px auto 0;
    padding: 0 24px 60px;
  }
  
  @media (max-width: 768px) {
    #giscus-comments {
      padding: 0 20px 40px;
      margin-top: 40px;
    }
  }
</style>
