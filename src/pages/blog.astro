---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import PostsListItem from "../components/PostsListItem.astro";
import PostsList from "../components/PostsList.astro";
import TagFilter from "../components/TagFilter.astro";

const posts = (await getCollection("posts"))
	.filter((post) => post.data.published === true && post.data.type === 'blog')
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const allTags = [...new Set(posts.flatMap((post) => post.data.tags))].sort();
---

<BaseLayout title="Blog" description="All blog posts">
	<Hero
		slot="hero"
		title="Blog"
		description="Thoughts, ideas, and things I've learned."
	/>

	<h2>All Posts</h2>
	<PostsList>
		{posts.map((post) => (
			<li class="list__item">
				<PostsListItem
					title={post.data.title}
					description={post.data.description}
					pubDate={post.data.pubDate}
					tags={post.data.tags}
					href={`/posts/${post.id}/`}
				/>
			</li>
		))}
	</PostsList>
	
	<TagFilter slot="sidebar-right" tags={allTags} />
</BaseLayout>
